<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SHOENIVERS</title>
  <link rel="stylesheet" href="index.css" />
  <!-- Icon chuẩn -->
  <link rel="icon" type="image/png" href="public/assets/logo/android-chrome-512x512.png">

  <!-- Nếu muốn hỗ trợ iOS/Android -->
  <link rel="apple-touch-icon" href="public/assets/logo/apple-touch-icon.png">
  <meta name="theme-color" content="#ffffff">

</head>

<body>
  <header>
    <nav id="navbar" class="navbar">
      <div class="logo-container">
        <h1 class="logo">SHOENIVERS</h1>
        <p class="tagline">BETA ACCESS</p>
      </div>
      <ul class="nav-links">
        <li><a href="index.html">Trang chủ</a></li>
        <li><a href="#" id="cartBtn">🛒 Giỏ hàng (<span id="cartCount">0</span>)</a></li>
        <li><a href="checkout.html">Thanh toán</a></li>
        <li><a id="navbarLogin" href="login.html">Đăng nhập</a></li>
        <li><a id="navbarLogout" href="#" style="display:none;">Đăng xuất</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="intro">
      <img src="public/assets/background.jpeg" alt="background">
      <div class="intro-content">
        <model-viewer src="public/assets/sport_shoe.glb" alt="Nike Air Force 1" camera-controls disable-zoom auto-rotate
          auto-rotate-delay="0" rotation-per-second="30deg" ar class="shoe-viewer">
        </model-viewer>
        <h2>THE UNIVERSE OF SHOE</h2>
        <p>Where the best quality shoes are waiting—not just for your budget, but for your lifestyle, your comfort, and
          your confidence. Whether you're chasing dreams, walking through daily challenges, or simply stepping into a
          new day, our shoes are designed to support every journey ahead—with style, durability, and affordability
          combined</p>
      </div>
      <div class="intro-button">
        <a href="login.html" style="text-decoration: none;"><button>Đăng nhập ngay</button></a>
      </div>
    </section>

    <section class="products">
      <h2>OUR HIGHLIGHT</h2>
      <div class="product-list" id="product-list"></div>
    </section>

    <!-- Modal chi tiết sản phẩm -->
    <div id="productModal" class="modal">
      <div class="modal-content">
        <img id="modalImage" src="" alt="">
        <div class="info">
          <h2 id="modalName"></h2>
          <p><strong>Giá:</strong> <span id="modalPrice"></span></p>
          <p><strong>Hãng:</strong> <span id="modalBrand"></span></p>
          <p><strong>Màu sắc:</strong> <span id="modalColor"></span></p>
          <p id="modalDesc"></p>
        </div>
        <div class="modal-button">
          <button id="btnAddCart" style="background-color: rgb(34, 34, 255)">Thêm vào giỏ hàng</button>
          <button id="btnBuy" style="background-color: rgb(38, 152, 0);">Mua</button>
          <button id="btnCloseModal" onclick="closeModal()" style="background-color: rgb(152, 0, 0);">Đóng</button>
        </div>
      </div>
    </div>

    <!-- Popup giỏ hàng -->
    <div id="cartPopup" class="cart-popup" aria-hidden="true">
      <h3>Giỏ hàng</h3>
      <ul id="cartItems"></ul>
      <p id="cartTotal"></p>
      <div class="cart-actions">
        <button id="clearCart">Xóa tất cả</button>
        <button onclick="closeCart()">Đóng</button>
      </div>
    </div>

    <section class="news">
      <h2>Tin tức & Báo chí</h2>
      <div class="news-list">
        <article class="news-item">
          <img src="public/assets/new1.jpg" alt="Tin 1">
          <h3>Shoenivers ra mắt bộ sưu tập giày thu đông 2025 – Đỉnh cao phong cách và sự thoải mái</h3>
          <p>Shoenivers chính thức giới thiệu bộ sưu tập Thu Đông 2025, mang đến trải nghiệm mới cho những tín đồ
            sneaker. Với cảm hứng từ đường phố New York và phong cách tối giản châu Âu, mỗi đôi giày được thiết kế để
            vừa êm ái, vừa thời trang, phù hợp từ đi làm đến đi chơi.
            Điểm đặc biệt là toàn bộ giày sử dụng đế CloudStep™ độc quyền giúp giảm sốc tối đa khi di chuyển. Bộ sưu tập
            hiện đã có mặt trên website và toàn bộ cửa hàng Shoenivers, với nhiều ưu đãi đặc biệt cho khách đặt sớm.</p>
          <a href="https://vn.louisvuitton.com/vie-vn/magazine/articles/men-fall-winter-2025-show" target="_blank">Xem
            chi tiết</a>
        </article>

        <article class="news-item">
          <img src="public/assets/new2.jpg" alt="Tin 2">
          <h3>Shoenivers bắt tay với nghệ sĩ Việt ra mắt phiên bản giới hạn</h3>
          <p>Shoenivers vừa công bố hợp tác với nghệ sĩ đường phố nổi tiếng KhoaLee để cho ra mắt dòng sneaker phiên bản
            giới hạn “Urban Canvas”. Mỗi đôi giày được vẽ thủ công từng chi tiết, biến chúng thành tác phẩm nghệ thuật
            có thể mang trên chân.
            Chỉ có 200 đôi trên toàn quốc, kèm chứng nhận độc quyền và chữ ký của nghệ sĩ. Đợt mở bán online đầu tiên đã
            cháy hàng trong 3 giờ. Dự kiến đợt mở bán tiếp theo sẽ diễn ra vào cuối tháng này – fan đừng bỏ lỡ!</p>
          <a href="https://www.lofficielvietnam.com/art-design/10-tac-pham-nghe-thuat-duong-pho-an-tuong-tren-the-gioi"
            target="_blank">Xem chi tiết</a>
        </article>
      </div>
    </section>

    <footer>
      <p>&copy; 2025 SHOENIVERS | Liên hệ: shoenivers@gmail.com</p>
    </footer>

    <div id="userPopup" class="userpopup" aria-hidden="true">
      <div class="popup-content">
        <button id="closePopup" class="close-popup">&times;</button>
        <img id="popupAvatar" src="" alt="avatar" class="popup-avatar">
        <h3 id="popupName"></h3>
        <p id="popupEmail"></p>
        <input type="file" id="avatarInput" style="display:none">
      </div>
    </div>

  </main>

  <script>
    // SNAP SCROLLING
    let isScrolling = false;
    let currentSection = 0; // 0 = intro, 1 = products
    const sections = document.querySelectorAll("main section");

    window.addEventListener("wheel", (e) => {
      if (isScrolling) return;
      isScrolling = true;

      if (e.deltaY > 0) {
        // Scroll xuống
        currentSection = Math.min(currentSection + 1, sections.length - 1);
      } else {
        // Scroll lên
        currentSection = Math.max(currentSection - 1, 0);
      }

      window.scrollTo({
        top: sections[currentSection].offsetTop,
        behavior: "smooth"
      });

      setTimeout(() => {
        isScrolling = false;
      }, 100); // Khoảng thời gian khóa cuộn
    });


    // helper keys
    const USERS_KEY = 'users_list';
    const CURRENT_USER_KEY = 'current_user';

    // NAVBAR SCROLL EFFECT
    const navbar = document.getElementById('navbar');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 50) navbar.classList.add('scrolled'); else navbar.classList.remove('scrolled');
    });

    // PRODUCT SCROLL
    const slider = document.querySelector('.product-list');
    let isDown = false;
    let startX;
    let scrollLeft;

    slider.addEventListener('mousedown', (e) => {
      isDown = true;
      slider.classList.add('active');
      startX = e.pageX - slider.offsetLeft;
      scrollLeft = slider.scrollLeft;
    });

    slider.addEventListener('mouseleave', () => {
      isDown = false;
      slider.classList.remove('active');
    });

    slider.addEventListener('mouseup', () => {
      isDown = false;
      slider.classList.remove('active');
    });

    slider.addEventListener('mousemove', (e) => {
      if (!isDown) return; // Chỉ chạy khi đang giữ chuột
      e.preventDefault();
      const x = e.pageX - slider.offsetLeft;
      const walk = (x - startX) * 1.5; // tốc độ kéo
      slider.scrollLeft = scrollLeft - walk;
    });


    // Render products data
    const products = [
      { id: 1, name: "Adidas Ultraboost", price: 3200000, brand: "Adidas", color: "Đen xám", desc: "Thiết kế hiện đại...", img: "public/assets/adidas_ultraboost.jpg", modal_img: "public/assets/adidas_ultraboost_modal.jpg" },
      { id: 2, name: "Nike Air Zoom", price: 2500000, brand: "Nike", color: "Trắng đen", desc: "Giày chạy bộ nhẹ...", img: "public/assets/nike_air_zoom.jpg", modal_img: "public/assets/nike_air_zoom_modal.jpg" },
      { id: 3, name: "Converse Classic", price: 1200000, brand: "Converse", color: "Trắng cổ điển", desc: "Phong cách basic...", img: "public/assets/converse_classic.jpg", modal_img: "public/assets/converse_classic_modal.jpg" },
      { id: 4, name: "Vans Old Skool", price: 1500000, brand: "Vans", color: "Đen trắng", desc: "Chất liệu canvas...", img: "public/assets/vans_oldskool.jpg", modal_img: "public/assets/vans_oldskool_modal.jpg" },
      { id: 5, name: "Puma RS-X", price: 2800000, brand: "Puma", color: "Xanh dương", desc: "Thiết kế thể thao...", img: "public/assets/puma_rsx.jpg", modal_img: "public/assets/puma_rsx_modal.jpg" },
      { id: 6, name: "New Balance 574", price: 2000000, brand: "New Balance", color: "Xám cổ điển", desc: "Phong cách retro...", img: "public/assets/nb_574.jpg", modal_img: "public/assets/nb_574_modal.jpg" },
      { id: 7, name: "Reebok Classic", price: 1800000, brand: "Reebok", color: "Trắng đỏ", desc: "Thiết kế đơn giản...", img: "public/assets/reebok_classic.jpg", modal_img: "public/assets/reebok_classic_modal.jpg" },
      { id: 8, name: "Asics Gel-Kayano", price: 3000000, brand: "Asics", color: "Xanh lá", desc: "Giày chạy bộ cao cấp...", img: "public/assets/asics_gel_kayano.jpg", modal_img: "public/assets/asics_gel_kayano_modal.jpg" }
    ];

    const productList = document.getElementById("product-list");
    productList.innerHTML = '';
    products.forEach(p => {
      productList.innerHTML += `
        <div class="product-item">
          <img src="${p.img}" alt="${p.name}">
          <h3>${p.name}</h3>
          <p>Giá: ${p.price.toLocaleString()}đ</p>
          <button onclick="openModal(${p.id})">Xem chi tiết</button>
        </div>
      `;
    });

    // Modal logic (single modal)
    function openModal(id) {
      const product = products.find(p => p.id === id);
      document.getElementById("modalImage").src = product.modal_img;
      document.getElementById("modalName").textContent = product.name;
      document.getElementById("modalPrice").textContent = product.price.toLocaleString() + "đ";
      document.getElementById("modalBrand").textContent = product.brand;
      document.getElementById("modalColor").textContent = product.color;
      document.getElementById("modalDesc").textContent = product.desc;

      document.getElementById("btnAddCart").onclick = () => addCart(product.id);
      document.getElementById("btnBuy").onclick = () => alert("Mua " + product.name);

      document.getElementById("productModal").style.display = "flex";
    }
    function closeModal() { document.getElementById("productModal").style.display = "none"; }

    // USER: helpers
    function getUsers() { return JSON.parse(localStorage.getItem(USERS_KEY) || '[]'); }
    function saveUsers(u) { localStorage.setItem(USERS_KEY, JSON.stringify(u)); }
    function getCurrentUser() { return JSON.parse(localStorage.getItem(CURRENT_USER_KEY) || 'null'); }
    function setCurrentUser(u) { localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(u)); updateNavbar(); updateCartCount(); }

    // PROFILE POPUP
    function showProfilePopup(user) {
      if (!user) return;
      document.getElementById('popupAvatar').src = user.avatar || 'public/assets/default_avatar.jpg';
      document.getElementById('popupName').textContent = user.displayName || user.name || '';
      document.getElementById('popupEmail').textContent = user.username || user.email || '';
      document.getElementById('userPopup').style.display = 'block';
    }
    document.getElementById('closePopup').addEventListener('click', () => document.getElementById('userPopup').style.display = 'none');
    document.getElementById('popupAvatar').addEventListener('click', () => document.getElementById('avatarInput').click());
    document.getElementById('avatarInput').addEventListener('change', function () {
      const file = this.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        const newAvatar = e.target.result;
        let cur = getCurrentUser();
        if (!cur) return alert('Bạn cần đăng nhập để đổi avatar');
        cur.avatar = newAvatar;
        setCurrentUser(cur);
        // update users list
        let users = getUsers();
        users = users.map(u => (u.username === cur.username ? { ...u, avatar: newAvatar } : u));
        saveUsers(users);
        document.getElementById('popupAvatar').src = newAvatar;
      }
      reader.readAsDataURL(file);
    });

    // CART per-user
    function cartKeyForUser(username) { return `cart_${username}`; }
    function getCart() { const u = getCurrentUser(); if (!u) return []; return JSON.parse(localStorage.getItem(cartKeyForUser(u.username)) || '[]'); }
    function saveCart(cart) { const u = getCurrentUser(); if (!u) return; localStorage.setItem(cartKeyForUser(u.username), JSON.stringify(cart)); updateCartCount(); }

    function addCart(id) {
      const user = getCurrentUser();
      if (!user) { alert('Vui lòng đăng nhập để thêm sản phẩm.'); window.location.href = 'login.html'; return; }
      let cart = getCart();
      const product = products.find(p => p.id === id);
      // increase qty if exists
      const exist = cart.find(i => i.id === id);
      if (exist) { exist.qty = (exist.qty || 1) + 1; } else { cart.push({ id: product.id, name: product.name, price: product.price, qty: 1, img: product.img }); }
      saveCart(cart);
      alert('Đã thêm ' + product.name + ' vào giỏ hàng!');
      renderCartPopup();
    }

    function renderCartPopup() {
      const cart = getCart();
      const list = document.getElementById('cartItems');
      list.innerHTML = '';
      let total = 0;
      if (cart.length === 0) { list.innerHTML = '<li>Giỏ hàng trống</li>'; document.getElementById('cartTotal').textContent = ''; return; }
      cart.forEach((it, idx) => {
        total += it.price * (it.qty || 1);
        list.innerHTML += `<li>
          <img src="${it.img}" alt="" style="width:46px;height:46px;object-fit:cover;border-radius:6px;margin-right:8px;vertical-align:middle;">
          ${it.name} <b>${(it.price).toLocaleString()}đ</b> x ${it.qty || 1}
          <button onclick="removeFromCart(${idx})" style="float:right">X</button>
        </li>`;
      });
      document.getElementById('cartTotal').textContent = 'Tổng: ' + total.toLocaleString() + 'đ';
    }

    function removeFromCart(index) {
      let cart = getCart();
      if (index < 0 || index >= cart.length) return;
      cart.splice(index, 1);
      saveCart(cart);
      renderCartPopup();
    }

    function clearCart() {
      const cur = getCurrentUser();
      if (!cur) return;
      localStorage.removeItem(cartKeyForUser(cur.username));
      renderCartPopup();
      updateCartCount();
    }

    function showCart() { renderCartPopup(); document.getElementById('cartPopup').style.display = 'block'; }
    function closeCart() { document.getElementById('cartPopup').style.display = 'none'; }

    // update cart count in navbar
    function updateCartCount() {
      const cur = getCurrentUser();
      const el = document.getElementById('cartCount');
      if (!cur) { el.textContent = '0'; return; }
      const cart = getCart();
      const count = cart.reduce((s, i) => s + (i.qty || 1), 0);
      el.textContent = count;
    }

    // toggle cart popup
    document.getElementById('cartBtn').addEventListener('click', (e) => {
      e.preventDefault();
      const popup = document.getElementById('cartPopup');
      if (popup.style.display === 'block') { closeCart(); } else { showCart(); }
    });

    // update navbar if logged in
    function updateNavbar() {
      const cur = getCurrentUser();
      const navbarLogin = document.getElementById('navbarLogin');
      const introBtn = document.querySelector('.intro-button');
      let logoutLink = document.getElementById('navbarLogout');

      if (cur) {
        // Ẩn intro button
        if (introBtn) introBtn.style.display = 'none';

        // Cập nhật nút login thành avatar + tên
        navbarLogin.innerHTML = `
      <img src="${cur.avatar || 'public/assets/default_avatar.jpg'}"
           class="nav-avatar"
           style="width:24px;height:24px;border-radius:50%;margin-right:6px;vertical-align:middle;">
      ${cur.displayName || cur.name}
    `;
        navbarLogin.href = '#';
        navbarLogin.onclick = (e) => { e.preventDefault(); showProfilePopup(cur); };

        // Nếu chưa có nút logout thì tạo
        if (!logoutLink) {
          logoutLink = document.createElement('li');
          logoutLink.innerHTML = `<a href="#" id="navbarLogout">Đăng xuất</a>`;
          document.querySelector('.nav-links').appendChild(logoutLink);
        }
        if (logoutLink.style.display === 'none') {
          logoutLink.style.display = '';
        }

        // Gán sự kiện logout
        document.getElementById('navbarLogout').onclick = (e) => {
          e.preventDefault();
          logoutUser(); // Hàm xóa user khỏi localStorage/session
          updateNavbar();
        };

      } else {
        // Hiện intro button lại
        if (introBtn) introBtn.style.display = '';

        // Cập nhật lại nút login
        navbarLogin.textContent = 'Đăng nhập';
        navbarLogin.href = 'login.html';
        navbarLogin.onclick = null;

        // Xóa nút logout nếu có
        if (logoutLink) logoutLink.remove();
      }
    }
    // LOGOUT USER
    function logoutUser() {
      // Xóa thông tin user khỏi localStorage
      localStorage.removeItem('current_user');

      // Nếu muốn xóa luôn sessionStorage
      sessionStorage.removeItem('current_user');

      // (Tùy chọn) Thông báo
      console.log('Đã đăng xuất');

      // Nếu muốn chuyển về trang chủ sau khi đăng xuất
      // window.location.href = '/';
    }


    //if user logined, the intro-button is hide
    document.addEventListener("DOMContentLoaded", () => {
      const user = getCurrentUser();
      const introBtn = document.querySelector(".intro-button");

      if (user && introBtn) {
        introBtn.style.display = "none";
      }
    });


    // init
    updateNavbar();
    updateCartCount();

  </script>

  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</body>

</html>